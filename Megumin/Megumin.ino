#include <Wire.h>
#include <Adafruit_ST7735.h>
#include <avr/pgmspace.h>
#include "song.h"

#define TFT_CS   10
#define TFT_RST  8
#define TFT_DC   9

Adafruit_ST7735 tft(TFT_CS, TFT_DC, TFT_RST);

struct Rect { uint8_t x, y, w, h; uint8_t c; };
const uint16_t megumin_colors[] PROGMEM = {
  ST77XX_BLACK, 0x41EB, 0x2907, 0x4A18, 0x65BE, 0xBEFF, 0x959B, 0x28CA, 0x4A76, 0x632F, 0x3188
};
const Rect rects[] PROGMEM = {  
  {0,16,30,1,0},{1,15,28,1,0},{2,14,26,1,0},{3,13,24,4,0},{4,13,22,7,0},{5,10,20,14,0},
  {6,8,18,2,0},{6,24,3,2,0},{7,7,21,1,0},{7,26,1,2,0},{8,6,18,1,0},{9,5,16,1,0},
  {9,24,1,1,0},{10,4,14,1,0},{11,3,12,1,0},{12,2,10,1,0},{13,1,8,1,0},{14,0,6,1,0},
  {20,24,1,1,0},{21,24,3,2,0},{22,26,1,2,0},{26,8,1,1,0},{27,8,2,2,0},{5,12,4,1,1},
  {5,13,1,1,1},{7,12,4,1,1},{8,7,3,1,1},{9,6,1,1,1},{11,11,8,1,1},{13,2,5,2,1},
  {13,6,1,1,1},{14,1,3,4,1},{14,5,2,2,1},{16,6,1,1,1},{19,7,1,1,1},{19,12,4,1,1},
  {20,6,2,2,1},{24,13,1,1,1},{18,1,2,1,2},{19,2,2,2,2},{20,3,2,2,2},{22,4,1,2,2},
  {23,5,1,2,2},{24,6,1,1,2},{7,9,4,2,3},{10,5,3,1,3},{11,4,1,1,3},{11,6,1,1,3},
  {11,8,8,2,3},{17,5,3,1,3},{18,4,1,1,3},{18,6,1,1,3},{19,9,4,2,3},{23,10,1,2,3},
  {2,15,1,1,4},{3,14,3,1,4},{6,10,1,2,4},{6,13,5,1,4},{7,9,1,1,4},{10,9,3,1,4},
  {11,5,1,1,4},{11,8,1,1,4},{11,12,8,1,4},{15,9,3,1,4},{16,8,1,1,4},{18,5,1,1,4},
  {19,10,3,1,4},{19,13,5,1,4},{20,9,1,1,4},{24,14,3,1,4},{27,8,1,1,4},{27,15,1,1,4},
  {8,17,1,4,5},{9,16,4,6,5},{10,15,2,1,6},{10,22,10,1,5},{13,17,1,6,5},{14,18,1,5,5},
  {15,19,2,4,5},{17,17,1,6,5},{18,15,2,1,6},{18,16,3,6,5},{21,17,1,4,5},{10,17,2,1,0},
  {10,18,2,1,7},{10,19,2,1,8},{18,17,2,1,0},{18,18,2,1,7},{18,19,2,1,8},{5,16,1,1,10},
  {5,17,2,3,9},{6,16,2,1,9},{6,20,1,2,9},{6,22,2,2,9},{7,23,2,2,9},{7,25,1,1,9},
  {9,23,1,1,9},{13,14,4,1,10},{13,15,1,1,9},{14,15,3,2,9},{15,17,1,1,9},{16,15,3,1,10},
  {20,23,1,1,9},{21,15,3,1,10},{21,23,2,2,9},{22,16,2,1,9},{22,22,2,2,9},{22,25,1,1,9},
  {23,17,2,3,9},{23,20,1,2,9},{24,16,1,1,10}
};  

void Logo(int x, int y, uint8_t scale) {
  for (uint16_t i = 0; i < sizeof(rects)/sizeof(rects[0]); i++) {
      Rect r;
      memcpy_P(&r, &rects[i], sizeof(Rect));
      uint16_t color = pgm_read_word(&megumin_colors[r.c]);
      int sx = (r.x - 17) * scale + x;
      int sy = (r.y - 15) * scale + y;
      int sw = max(1, r.w * scale);
      int sh = max(1, r.h * scale);
      tft.fillRect(sx, sy, sw, sh, color);
  }
}

void setup() {
  tft.initR(INITR_GREENTAB);
  tft.setRotation(0);
  tft.fillScreen(0x18A8);
  pinMode(5, OUTPUT);

  Logo(69,70,3);
  playSong(5);
}

void loop() {}